name: Build and Deploy to itch.io

on:
  push:
    branches:
      - main  # 在 main 分支推送時觸發

jobs:
  build-and-deploy:
    runs-on: ubuntu-latest

    steps:
    # 檢出專案程式碼
    - name: Checkout code
      uses: actions/checkout@v3

    # 設置 Unity 環境
    - name: Set up Unity
      uses: game-ci/unity-builder@v2
      with:
        unityVersion: '6000.0.26f1'  # 根據專案使用的 Unity 版本設定
        targetPlatform: StandaloneWindows64  # 替換為 macOS 或 Linux 如需要

    # 建置專案
    - name: Build project
      uses: game-ci/unity-builder@v2
      with:
        targetPlatform: StandaloneWindows64  # 指定電腦平台
        buildName: MyUnityGame  # 指定建置名稱
        buildPath: build/  # 指定輸出目錄

    # 安裝 Butler
    - name: Install Butler
      run: |
        curl -L -o butler.zip https://broth.itch.ovh/butler/linux-amd64/LATEST/archive/default
        unzip butler.zip -d butler
        chmod +x butler/butler
        sudo mv butler/butler /usr/local/bin

    # 部署至 itch.io
    - name: Deploy to itch.io
      env:
        BUTLER_CREDENTIALS: ${{ secrets.BUTLER_CREDENTIALS }}  # 從 GitHub Secrets 獲取 API 密鑰
      run: |
        butler push build/StandaloneWindows64/ yourusername/yourgame:platform
